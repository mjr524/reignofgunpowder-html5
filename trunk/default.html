<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <title>ReignOfGunpowder</title>

    <!-- Références WinJS -->
    <!--    <link href="//Microsoft.WinJS.1.0/css/ui-dark.css" rel="stylesheet" />
    <script src="//Microsoft.WinJS.1.0/js/base.js"></script>
    <script src="//Microsoft.WinJS.1.0/js/ui.js"></script>-->

    <!-- Références ReingOfGamepowder -->
    <!--    <link href="/css/default.css" rel="stylesheet" />
    <script src="/js/default.js"></script>-->
    <!-- Librairie EASEL.JS -->
    <!--<link href="assets/demoStyles.css" rel="stylesheet" type="text/css" />-->
    <script type="text/javascript" src="src/Utils/Prototype.js"></script>
    <script type="text/javascript" src="src/Utils/Singleton.js"></script>
    <script type="text/javascript" src="easeljs/utils/UID.js"></script>
    <script type="text/javascript" src="easeljs/geom/Matrix2D.js"></script>
    <script type="text/javascript" src="easeljs/display/DisplayObject.js"></script>
    <script type="text/javascript" src="easeljs/display/Container.js"></script>
    <script type="text/javascript" src="easeljs/display/Shadow.js"></script>
    <script type="text/javascript" src="easeljs/display/SpriteSheet.js"></script>
    <script type="text/javascript" src="easeljs/display/Stage.js"></script>
    <script type="text/javascript" src="easeljs/events/MouseEvent.js"></script>
    <script type="text/javascript" src="easeljs/display/Shape.js"></script>
    <script type="text/javascript" src="easeljs/display/Graphics.js"></script>
    <script type="text/javascript" src="easeljs/utils/Ticker.js"></script>
    <script type="text/javascript" src="easeljs/display/Bitmap.js"></script>
    <script type="text/javascript" src="easeljs/display/Text.js"></script>
    <script type="text/javascript" src="easeljs/geom/Rectangle.js"></script>
    <script type="text/javascript" src="easeljs/geom/Point.js"></script>
    <script type="text/javascript" src="easeljs/utils/SpriteSheetUtils.js"></script>
    <script type="text/javascript" src="easeljs/display/BitmapAnimation.js"></script>

    <!-- Nos Librairies -->
    <!-- Utils -->
	<script src="src/Utils/XNARectangle.js"></script>
    <!-- BO -->
    <script src="src/BO/Bombe.js"></script>
    <script src="src/BO/Perso.js"></script>
	<script src="src/BO/Flamme.js"></script>
	<script src="src/BO/Decor.js"></script>
	<script src="src/BO/Bonus.js"></script>
    <!-- BLL -->
    <script src="src/BLL/LesBombes.js"></script>
    <script src="src/BLL/LesPersos.js"></script>
    <script src="src/BLL/LesFlammes.js"></script>
    <script src="src/BLL/LesDecors.js"></script>
    <script src="src/BLL/LesBonus.js"></script>



    <!-- We also provide hosted minified versions of all CreateJS libraries.
	  http://code.createjs.com -->

    <script type="text/javascript">
        var canvas;
        var stage;
        var fpsLabel;
        var map;
		
		//Les constantes
		

        //Les différents tableaux
        var tab_bombes = LesBombes.GetInstance();
		var tab_persos = LesPersos.GetInstance();
		var tab_flammes = LesFlammes.GetInstance();
		var tab_decors = LesDecors.GetInstance();
		var tab_bonus = LesBonus.GetInstance();

		//Images
        var perso = new Image();
        var bombe = new Image();
		var bombeRouge = new Image();
		var explosion = new Image();
		var arbre = new Image();
		var panneau = new Image();
        var Hero = null;
        var Bebom = null;
		var Arbre = null;
		var Panneau = null;

		//Touches
        var KEYCODE_SPACE = 32;		//usefull keycode
        var KEYCODE_DOWN = 40;
        var KEYCODE_UP = 38;		//usefull keycode
        var KEYCODE_LEFT = 37;		//usefull keycode
        var KEYCODE_RIGHT = 39;		//usefull keycode

        //register key functions
        document.onkeydown = handleKeyDown;
        document.onkeyup = handleKeyUp;

        function init() {
            canvas = document.getElementById('myCanvas');
            width = canvas.width;
            height = canvas.height;
            stage = new createjs.Stage(canvas);

            map = new createjs.Bitmap("images/background.jpg");

            fpsLabel = new createjs.Text("-- fps", "bold 14px Arial", "#000");
            fpsLabel.x = 10;
            fpsLabel.y = 10;

            //Chargement des images
            perso.src = "images/perso.png";
            bombe.src = "images/bomb.png";
			bombeRouge.src = "images/bomb2.png";
			explosion.src = "images/explosion.png";
			arbre.src = "images/stump.png"; 
			panneau.src = "images/panneau.png";
			explosion_sprite = "images/Sprite_explosion3.png";
			bombe_sprite = "images/Sprite_bombe.png";

            // On lance la séquence d’animation
            stage.addChild(map);
            stage.addChild(fpsLabel);			
            stage.update();

            createjs.Ticker.setInterval(17);
            createjs.Ticker.addListener(window);
            createjs.Ticker.useRAF = true;
            createjs.Ticker.setFPS(60);
            
            Charger();
			
			Hero = new Perso(perso, new createjs.Point( 400, 200), new createjs.Point( 32, 48));
			Arbre = new Decor(arbre, new createjs.Point(200,200), new createjs.Point(100,150), new XNARectangle(210,270,25,25), true, false);
			Panneau = new Bonus(panneau, new createjs.Point(400,400),new createjs.Point(32,32),new XNARectangle(400,400,32,32));
        }

        function tick() {
            fpsLabel.text = Math.round(createjs.Ticker.getMeasuredFPS()) + " fps";
            tab_bonus.tick();
            tab_persos.tick();
            tab_bombes.tick();
			tab_flammes.tick();
            stage.update();
        }

        function handleKeyDown(e) {
            //cross browser issues exist
            if (!e) { var e = window.event; }
            e.preventDefault();
            switch (e.keyCode) {
                case KEYCODE_LEFT: Hero.Deplacer(4); break;
                case KEYCODE_RIGHT: Hero.Deplacer(2); break;
                case KEYCODE_UP: Hero.Deplacer(1); break;
                case KEYCODE_DOWN: Hero.Deplacer(3); break;
                case KEYCODE_SPACE: Hero.PoserBombe(); break;
            }
        }

        function handleKeyUp(e) {}
		
		function CreerExplosion(position, puissance){
			for (var i = puissance; i >= 0; i--) {
				if(i==0)
					new Flamme(explosion_sprite, new createjs.Point(position.x,position.y),new createjs.Point(50,75));
				else{
					new Flamme(explosion_sprite, new createjs.Point(position.x + i*30,position.y),new createjs.Point(50,75));
					new Flamme(explosion_sprite, new createjs.Point(position.x - i*30,position.y),new createjs.Point(50,75));
					new Flamme(explosion_sprite, new createjs.Point(position.x,position.y + i*30),new createjs.Point(50,75));
					new Flamme(explosion_sprite, new createjs.Point(position.x,position.y - i*30),new createjs.Point(50,75));
				}	
			}
		}
		
		function Charger(){
			var req = new XMLHttpRequest();
			req.open("GET", "fichier.json", true);
			req.onreadystatechange = monCode(req);   // la fonction de prise en charge
			req.send(null); 
		}
		
		function monCode(req) 
		{ 
			//alert(req.readyState);
		   if (req.readyState == 4) 
		   { 
		         var doc = eval('(' + req.responseText + ')'); 
		         alert(doc);
		   }
		}

	</script>
</head>

<body onload="init()">

    <!--    <header id="header" class="EaselJS">
        <h1><span class="text-product">Reign of GunPowder</span></h1>
        <p>Test du jeu</p>
    </header>-->

    <canvas id="myCanvas" width="1000" height="500">ROG</canvas>

</body>
</html>
